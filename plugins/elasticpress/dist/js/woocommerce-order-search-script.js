!function(){"use strict";var e=window.wp.element,t=window.wp.i18n,s=window.wp.hooks;var a={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let r;const n=new Uint8Array(16);function o(){if(!r&&(r="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(n)}const c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));function l(e,t=0){return c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]}var i=function(e,t,s){if(a.randomUUID&&!t&&!e)return a.randomUUID();const r=(e=e||{}).random||(e.rng||o)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){s=s||0;for(let e=0;e<16;++e)t[s+e]=r[e];return t}return l(r)};const u=(a,r,n,o,c="")=>{const l=(0,e.useRef)(new AbortController),u=(0,e.useRef)(null),d=(0,e.useRef)(o);return(0,e.useCallback)((async e=>{const o=`${a}${r}?${e.toString()}`;l.current.abort(),l.current=new AbortController;const p={Accept:"application/json",Authorization:n},g=(e=>{const t=i().replaceAll("-","");return(0,s.applyFilters)("ep.requestId",e+t)})(c);return g&&(p["X-ElasticPress-Request-ID"]=g),u.current=fetch(o,{signal:l.current.signal,headers:p}).then((e=>{if(!e.ok){if(401===e.status&&d.current)return d.current(),"";throw new Error((0,t.sprintf)((0,t.__)("HTTP %d.","elasticpress"),e.status))}return e.json()})).catch((e=>{if("AbortError"!==e?.name)throw e})).finally((()=>{u.current=null})),u.current}),[a,r,n,c])},d=(e,t,s="")=>{const a=new URLSearchParams;return Object.entries(t).forEach((([t,r])=>{const n=s+t,o="undefined"!==typeof e[t]?((e,t,s=!0)=>{let a=null;switch(e&&t.type){case"number":case"string":a=e;break;case"numbers":case"strings":a=e.join(",")}return t.allowedValues&&(a=t.allowedValues.includes(a)?a:null),s&&null===a&&"undefined"!==typeof t.default&&(a=t.default),a})(e[t],r):null;null!==o&&a.set(n,o)})),a},p=(e,t="")=>{const s=new URLSearchParams(window.location.search);return Object.entries(e).reduce(((e,[a,r])=>{const n=s.get(t+a),o="undefined"!==typeof n?((e,t,s=!0)=>{let a=null;switch(e&&t.type){case"number":a=parseFloat(e,10)||null;break;case"numbers":a=decodeURIComponent(e).split(",").map((e=>parseFloat(e,10))).filter(Boolean);break;case"string":a=e.toString();break;case"strings":a=decodeURIComponent(e).split(",").map((e=>e.toString().trim()))}return t.allowedValues&&(a=t.allowedValues.includes(a)?a:null),s&&null===a&&"undefined"!==typeof t.default&&(a=t.default),a})(n,r,!1):null;return null!==o&&(e[a]=o),e}),{})},g=(e,t)=>{const s=new URL(window.location.href),a=Array.from(s.searchParams.keys());for(const t of a)t.startsWith(e)&&s.searchParams.delete(t);return t&&t.forEach(((e,t)=>{s.searchParams.set(t,e)})),s.toString()},m=(e,t)=>{const s={...e};return Object.entries(t).forEach((([e,t])=>{Object.hasOwnProperty.call(t,"default")||delete s[e]})),s};var f=(e,t)=>{const s={...e,isPoppingState:!1};switch(t.type){case"CLEAR_CONSTRAINTS":{const e=m(s.args,s.argsSchema);s.args=e,s.args.offset=0;break}case"CLEAR_RESULTS":s.aggregations={},s.searchResults=[],s.totalResults=0;break;case"SEARCH":{const{updateDefaults:e,...a}=t.args;s.args={...s.args,...a,offset:0},s.isOn=!0,e&&a.post_type.length&&(s.argsSchema.post_type.default=a.post_type);break}case"SEARCH_FOR":{const e=m(s.args,s.argsSchema);s.args=e,s.args.search=t.searchTerm,s.args.offset=0,s.isOn=!0;break}case"SET_IS_LOADING":s.isLoading=t.isLoading;break;case"TURN_OFF":s.args={...s.args},s.isOn=!1;break;case"SET_RESULTS":{const{hits:{hits:e,total:a},aggregations:r,suggest:n}=t.response;s.isFirstSearch=!1;const o="number"===typeof a?a:a.value;s.aggregations=r,s.searchResults=e,s.searchTerm=s.args.search,s.totalResults=o,s.suggestedTerms=n?.ep_suggestion?.[0]?.options||[];break}case"NEXT_PAGE":s.args.offset+=s.args.per_page;break;case"PREVIOUS_PAGE":s.args.offset=Math.max(s.args.offset-s.args.per_page,0);break;case"POP_STATE":{const{isOn:e,args:a}=t.args;s.args=a,s.isOn=e,s.isPoppingState=!0;break}}return s};const h=(0,e.createContext)(),b=({apiEndpoint:s,apiHost:a,authorization:r,requestIdBase:n,argsSchema:o,children:c,paramPrefix:l,onAuthError:i})=>{const m=(0,e.useMemo)((()=>l?p(o,l):{}),[o,l]),b=(0,e.useMemo)((()=>{const e=(e=>Object.entries(e).reduce(((e,[t,s])=>(Object.hasOwnProperty.call(s,"default")&&(e[t]=s.default),e)),{}))(o);return{...e,...m}}),[o,m]),w=(0,e.useMemo)((()=>Object.keys(m).length>0),[m]),R=u(a,s,r,i,n),[y,E]=(0,e.useReducer)(f,{aggregations:{},args:b,argsSchema:o,isLoading:!1,isOn:w,isPoppingState:!1,searchResults:[],totalResults:0,suggestedTerms:[],isFirstSearch:!0,searchTerm:""}),_=(0,e.useRef)(y);_.current=y;const S=(0,e.useCallback)((()=>{E({type:"CLEAR_CONSTRAINTS"})}),[]),v=(0,e.useCallback)((()=>{E({type:"CLEAR_RESULTS"})}),[]),k=(0,e.useCallback)((e=>{E({type:"SEARCH",args:e})}),[]),O=e=>{E({type:"SET_IS_LOADING",isLoading:e})},C=e=>{E({type:"SET_RESULTS",response:e})},T=(0,e.useCallback)((()=>{if("undefined"===typeof l)return;const{args:e,isOn:t}=_.current,s={args:e,isOn:t};if(window.history.state)if(t){const t=d(e,o,l),a=g(l,t);window.history.pushState(s,document.title,a)}else{const e=g(l);window.history.pushState(s,document.title,e)}else window.history.replaceState(s,document.title,window.location.href)}),[o,l]),P=(0,e.useCallback)((e=>{if("undefined"===typeof l)return;e.state&&Object.keys(e.state).length>0&&(e=>{E({type:"POP_STATE",args:e})})(e.state)}),[l]),A=(0,e.useCallback)((()=>(window.addEventListener("popstate",P),()=>{window.removeEventListener("popstate",P)})),[P]),U=(0,e.useCallback)((()=>{(async()=>{const{args:e,isOn:s,isPoppingState:a}=_.current;if(a||T(),!s)return;const r=d(e,o);O(!0);try{const e=await R(r);if(!e)return;C(e)}catch(e){const s=(0,t.sprintf)((0,t.__)("ElasticPress: Unable to fetch results. %s","elasticpress"),e.message);console.error(s)}O(!1)})()}),[o,R,T]);(0,e.useEffect)(A,[A]),(0,e.useEffect)(U,[U,y.args,y.args.orderby,y.args.order,y.args.offset,y.args.search]);const{aggregations:F,args:L,isLoading:I,isOn:N,searchResults:j,searchTerm:$,totalResults:x,suggestedTerms:D,isFirstSearch:V}=_.current,B={aggregations:F,args:L,clearConstraints:S,clearResults:v,getUrlParamsFromArgs:d,getUrlWithParams:g,isLoading:I,isOn:N,searchResults:j,searchTerm:$,search:k,searchFor:e=>{E({type:"SEARCH_FOR",searchTerm:e})},setResults:C,nextPage:()=>{E({type:"NEXT_PAGE"})},previousPage:()=>{E({type:"PREVIOUS_PAGE"})},totalResults:x,turnOff:()=>{E({type:"TURN_OFF"})},suggestedTerms:D,isFirstSearch:V};return React.createElement(h.Provider,{value:B},c)};function w(){return w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},w.apply(null,arguments)}var R=({children:s,id:a,isBusy:r,onSelect:n,...o})=>{const[c,l]=(0,e.useState)(!1),[i,u]=(0,e.useState)(!1),d=(0,e.useMemo)((()=>s[i]?s[i].props.id:null),[s,i]),p=(0,e.useMemo)((()=>s.length&&!r?(0,t.sprintf)((0,t._n)("%d suggestion available, use the up and down keys to browse and the enter key to open","%d suggestions available, use the up and down keys to browse and the enter key to open",s.length,"elasticpress"),s.length):""),[s,r]),g=(0,e.useMemo)((()=>!(!1===i||!s[i])&&s[i].props.value),[s,i]),m=(0,e.useCallback)((()=>!!s.length&&0),[s]),f=(0,e.useCallback)((()=>!!s.length&&s.length-1),[s]),h=(0,e.useCallback)((()=>{const e=m(s);if(!1===i)return e;const t=i+1;return s?.[t]?t:e}),[s,m,i]),b=(0,e.useCallback)((()=>{const e=f(s);if(!1===i)return e;const t=i-1;return s?.[t]?t:e}),[s,f,i]),R=(0,e.useCallback)((()=>{l(!!s.length)}),[s]),y=(0,e.useCallback)((e=>{e.currentTarget.contains(e.relatedTarget)||(u(!1),l(!1))}),[]),E=(0,e.useCallback)((e=>{const t=h(i,s),a=b(i,s);switch(e.key){case"ArrowDown":e.preventDefault(),u(t);break;case"ArrowUp":e.preventDefault(),u(a);break;case"Enter":!1!==g&&(e.preventDefault(),n(g,e));break;case"Escape":c&&(e.preventDefault(),u(!1),l(!1))}}),[s,h,b,c,n,i,g]);return(0,e.useEffect)((()=>{u(!1),l(!!s.length)}),[s]),(0,e.useEffect)((()=>{!1!==i&&l(!0)}),[i]),React.createElement("div",{className:"ep-combobox",onBlur:y},React.createElement("input",w({"aria-activedescendant":d,"aria-autocomplete":"list","aria-controls":a,"aria-describedby":`${a}-description`,"aria-expanded":!r&&c,autoComplete:"off",className:"ep-combobox__input",onFocus:R,onKeyDown:E,role:"combobox"},o)),React.createElement("div",{id:`${a}-description`,className:"screen-reader-text"},p),React.createElement("ul",{id:a,role:"listbox",className:"ep-combobox__list"},s.map(((e,t)=>{const{id:s,value:a}=e.props;return React.createElement("li",{"aria-selected":i===t,className:"ep-combobox__option",key:s,onClick:e=>{n(a,e)},role:"option",tabIndex:"-1"},e)}))))},y=window.wp.date,E=({dateFormat:e,hit:s,statusLabels:a,timeFormat:r})=>{const{meta:{_billing_email:[{value:n}={}]=[],_billing_first_name:[{value:o}={}]=[],_billing_last_name:[{value:c}={}]=[],_items:[{value:l}={}]=[]},post_date_gmt:i,post_id:u,post_status:d}=s._source,p=`${i.split(" ").join("T")}+00:00`,g=(0,y.dateI18n)(e,p),m=(0,y.dateI18n)(r,p),f=l?l.split("|").length:0,h=`status-${d.substring(3)}`,b=a[d];return React.createElement("div",{className:"ep-suggestion"},React.createElement("div",{className:"ep-suggestion__header"},React.createElement("div",{className:"ep-suggestion__title"},`#${u}`," ",o," ",c),n),React.createElement("div",{className:"ep-suggestion__footer"},React.createElement("div",{className:"ep-suggestion__details"},(0,t.sprintf)((0,t._n)("%1$d item @ %2$s","%1$d items @ %2$s",f,"elasticpress"),f,m),React.createElement("br",null),g),b&&React.createElement("div",{className:`order-status ${h} tips`},React.createElement("span",null,b))))};function _(){return _=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},_.apply(null,arguments)}var S=({adminUrl:t,dateFormat:s,statusLabels:a,timeFormat:r,value:n,...o})=>{const{clearResults:c,isLoading:l,searchFor:i,searchResults:u}=(0,e.useContext)(h),d=((t,s)=>{const a=(0,e.useRef)(null);return(0,e.useCallback)(((...e)=>{window.clearTimeout(a.current),a.current=window.setTimeout((()=>{t(...e)}),s)}),[t,s])})((e=>{i(e)}),300),p=(0,e.useCallback)((e=>{const{value:t}=e.target;t?d(e.target.value):c()}),[c,d]),g=(0,e.useCallback)(((e,s)=>{window.open(`${t}?post=${e}&action=edit`,s.metaKey?"_blank":"_self")}),[t]);return React.createElement(R,_({defaultValue:n,id:"ep-orders-suggestions",isBusy:l,onInput:p,onSelect:g},o),u.map((e=>{const{_id:t,_source:{post_id:n}}=e;return React.createElement(E,{dateFormat:s,id:`ep-order-suggestion-${t}`,hit:e,key:t,statusLabels:a,timeFormat:r,value:n})})))};const{adminUrl:v,apiEndpoint:k,apiHost:O,credentialsApiUrl:C,credentialsNonce:T,argsSchema:P,dateFormat:A,statusLabels:U,timeFormat:F,requestIdBase:L}=window.epWooCommerceOrderSearch;function I(){return I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},I.apply(null,arguments)}const N=({children:t})=>{const[s,a]=(0,e.useState)(null),r=(0,e.useRef)(!1);return(0,e.useEffect)((()=>{fetch(C,{headers:{"X-WP-Nonce":T}}).then((e=>e.text())).then(a)}),[]),s?React.createElement(b,{apiEndpoint:k,apiHost:O,argsSchema:P,authorization:`Basic ${s}`,requestIdBase:L,onAuthError:()=>{r.current?a(null):(fetch(C,{headers:{"X-WP-Nonce":T},method:"POST"}).then((e=>e.text())).then(a),r.current=!0)}},t):null};(async()=>{const t=document.querySelector("#posts-filter, #wc-orders-filter").s;if(!t)return;const s=Object.values(t.attributes).reduce(((e,t)=>({...e,[t.name]:t.value})),{}),a=document.createElement("div");if(a.setAttribute("id","ep-woocommerce-order-search"),t.replaceWith(a),"function"===typeof e.createRoot){(0,e.createRoot)(a).render(React.createElement(N,null,React.createElement(S,I({adminUrl:v,dateFormat:A,statusLabels:U,timeFormat:F},s))))}else(0,e.render)(React.createElement(N,null,React.createElement(S,I({adminUrl:v,dateFormat:A,statusLabels:U,timeFormat:F},s))),a)})()}();