!function(){"use strict";var e={1020:function(e,t,a){var n=a(1609),l=Symbol.for("react.element"),i=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function o(e,t,a){var n,i={},o=null,p=null;for(n in void 0!==a&&(o=""+a),void 0!==t.key&&(o=""+t.key),void 0!==t.ref&&(p=t.ref),t)r.call(t,n)&&!c.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:l,type:e,key:o,ref:p,props:i,_owner:s.current}}t.jsx=o},4848:function(e,t,a){e.exports=a(1020)},1609:function(e){e.exports=window.React}},t={};function a(n){var l=t[n];if(void 0!==l)return l.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,a),i.exports}a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,{a:t}),t},a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var n=window.wp.element,l=window.wp.i18n,i=window.wp.components,r=window.wp.data,s=window.wp.notices;const c=(0,n.createContext)(),{Fill:o,Slot:p}=(0,i.createSlotFill)("SettingsPageAction"),d=({children:e,title:t})=>{const{createNotice:a,removeNotice:l}=(0,r.useDispatch)(s.store),{notices:d}=(0,r.useSelect)((e=>({notices:e(s.store).getNotices()})),[]),u=(0,n.useMemo)((()=>({ActionSlot:o,createNotice:a,removeNotice:l})),[a,l]);return React.createElement(i.SlotFillProvider,null,React.createElement(c.Provider,{value:u},React.createElement("div",{className:"ep-settings-page"},React.createElement("div",{className:"ep-settings-page__wrap"},React.createElement("header",{className:"ep-settings-page__header"},React.createElement("h1",{className:"ep-settings-page__title"},t),React.createElement(p,null)),e),React.createElement(i.SnackbarList,{className:"ep-settings-page__snackbar-list",notices:d,onRemove:e=>l(e)}))))},u=()=>(0,n.useContext)(c),{apiUrl:m,metaMode:g,syncUrl:h,weightableFields:w,weightingConfiguration:_}=window.epWeighting;var f=window.wp.apiFetch,y=a.n(f);const R=(0,n.createContext)(),v=({apiUrl:e,children:t,metaMode:a,weightableFields:l,weightingConfiguration:i})=>{const[r,s]=(0,n.useState)({...i}),[c,o]=(0,n.useState)(!1),p=(0,n.useMemo)((()=>"manual"===a),[a]),d={currentWeightingConfiguration:r,isBusy:c,isManual:p,save:async()=>{o(!0);try{await y()({body:JSON.stringify(r),headers:{"Content-Type":"application/json"},method:"POST",url:e})}catch(e){throw console.error(e),e}finally{o(!1)}},setWeightingForPostType:(e,t)=>{s({...r,[e]:t})},weightableFields:l};return React.createElement(R.Provider,{value:d},t)},E=()=>(0,n.useContext)(R);var b=window.wp.primitives,x=a(4848);var k=(0,x.jsx)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,x.jsx)(b.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})}),N=({label:e,onChange:t,onDelete:a,value:n,showTooltip:r})=>{const{enabled:s=!1,weight:c=0}=n;return React.createElement("div",{className:"ep-weighting-field"},React.createElement("fieldset",null,React.createElement("legend",{className:"ep-weighting-field__name"},r?React.createElement(i.Tooltip,{text:e},React.createElement("span",null,e)):e),React.createElement("div",{className:"ep-weighting-field__searchable"},React.createElement(i.CheckboxControl,{checked:s,label:(0,l.__)("Searchable","elasticpress"),onChange:e=>{t({weight:c,enabled:e})},__nextHasNoMarginBottom:!0})),React.createElement("div",{className:"ep-weighting-field__weighting"},React.createElement(i.RangeControl,{disabled:!s,label:(0,l.__)("Weight","elasticpress"),max:100,min:1,onChange:e=>{t({enabled:!0,weight:e})},value:c,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})),React.createElement("div",{className:"ep-weighting-field__actions"},React.createElement(i.Button,{className:"ep-weighting-action ep-weighting-action--delete",disabled:!a,icon:k,label:(0,l.__)("Remove","elasticpress"),onClick:a}))))},S=({group:e,postType:t})=>{const{createNotice:a}=u(),{currentWeightingConfiguration:r,setWeightingForPostType:s,weightableFields:c}=E(),[o,p]=(0,n.useState)(""),d=r[t],{fields:m}=c.find((e=>e.key===t)),g="ep_metadata"===e,h=(0,n.useMemo)((()=>m.filter((t=>t.group===e))),[m,e]),w=(0,n.useMemo)((()=>{if(!g)return[];const e=m.map((({key:e})=>e));return Object.keys(d).reduce(((t,a)=>{if(e.includes(a))return t;const n=a.match(/meta\.(?<label>.*)\.value/);if(!n)return t;const{label:l}=n.groups;return t.push({key:a,label:l}),t}),[])}),[m,g,d]),_=(e,a)=>{s(t,{...d,[a]:e})},f=()=>{const e=`meta.${o}.value`,n=h.some((t=>t.key===e)),i=w.some((t=>t.key===e));if(n||i)return void a("info",(0,l.sprintf)((0,l.__)("%s is already being synced.","elasticpress"),o));const r={...d,[e]:{enabled:!1,weight:0}};s(t,r),p("")};return React.createElement(React.Fragment,null,h.map((({key:e,label:t})=>React.createElement(i.PanelRow,{key:e},React.createElement(N,{label:t,value:d?.[e]||{},onChange:t=>{_(t,e)}})))),w.map((({key:e,label:a})=>React.createElement(i.PanelRow,{key:e},React.createElement(N,{label:a,value:d?.[e]||{},onChange:t=>{_(t,e)},onDelete:()=>{(e=>{const a={...d};delete a[e],s(t,a)})(e)},showTooltip:!0})))),g?React.createElement(i.PanelRow,{className:"ep-weighting-add-new"},React.createElement(i.TextControl,{help:(0,l.__)("Make sure to Sync after adding new fields to ensure that the fields are synced for any existing content that uses them.","elasticpress"),label:(0,l.__)("Add field","elasticpress"),onChange:e=>p(e),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),f())},placeholder:(0,l.__)("Metadata key","elasticpress"),value:o,__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),React.createElement(i.Button,{disabled:!o,isSecondary:!0,onClick:f,variant:"secondary"},(0,l.__)("Add","elasticpress"))):null)},C=({postType:e})=>{const{isManual:t,weightableFields:a}=E(),{label:n,groups:l}=a.find((t=>t.key===e));return React.createElement(i.Panel,{className:"ep-weighting-post-type"},React.createElement(i.PanelHeader,null,React.createElement("h2",null,n)),l.map((({key:a,label:n})=>{const l="ep_metadata"===a;return!l||t?React.createElement(i.PanelBody,{initialOpen:!l,key:a,title:n},React.createElement(S,{group:a,label:n,postType:e})):null})))},P=()=>{const{createNotice:e}=u(),{isBusy:t,save:a,weightableFields:n}=E();return React.createElement(React.Fragment,null,React.createElement("p",null,(0,l.__)("This dashboard enables you to select which fields ElasticPress should sync, whether to use those fields in searches, and how heavily to weight fields in the search algorithm. In general, increasing the Weight of a field will increase the relevancy score of a post that has matching text in that field.","elasticpress")),React.createElement("p",null,(0,l.__)("For example, adding more weight to the title attribute will cause search matches on the post title to appear more prominently.","elasticpress")),React.createElement("form",{className:"ep-weighting-screen",onSubmit:async t=>{t.preventDefault();try{await a(),e("success",(0,l.__)("Settings saved.","elasticpress"))}catch(t){e("error",(0,l.__)("Something went wrong. Please try again.","elasticpress"))}}},n.map((({key:e})=>React.createElement(C,{key:e,postType:e}))),React.createElement(i.Button,{disabled:t,isBusy:t,isPrimary:!0,type:"submit",variant:"primary"},(0,l.__)("Save changes","elasticpress"))))};const F=()=>React.createElement(d,{title:(0,l.__)("Manage Search Fields & Weighting","elasticpress")},React.createElement(v,{apiUrl:m,metaMode:g,syncUrl:h,weightingConfiguration:_,weightableFields:w},React.createElement(P,null)));if("function"===typeof n.createRoot){(0,n.createRoot)(document.getElementById("ep-weighting-screen")).render(React.createElement(F,null))}else(0,n.render)(React.createElement(F,null),document.getElementById("ep-weighting-screen"))}();