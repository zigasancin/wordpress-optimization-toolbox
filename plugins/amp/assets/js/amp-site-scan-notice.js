(()=>{var e={184:(e,t)=>{var n;!function(){"use strict";var r={}.hasOwnProperty;function s(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var a=typeof n;if("string"===a||"number"===a)e.push(n);else if(Array.isArray(n)){if(n.length){var l=s.apply(null,n);l&&e.push(l)}}else if("object"===a){if(n.toString!==Object.prototype.toString&&!n.toString.toString().includes("[native code]")){e.push(n.toString());continue}for(var i in n)r.call(n,i)&&n[i]&&e.push(i)}}}return e.join(" ")}e.exports?(s.default=s,e.exports=s):void 0===(n=function(){return s}.apply(t,[]))||(e.exports=n)}()}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.wp.element,t=ampSiteScanNotice,r=window.wp.domReady;var s=n.n(r);const a=window.wp.i18n,l=(0,e.createContext)();function i({children:t}){const[n,r]=(0,e.useState)(null);return(0,e.createElement)(l.Provider,{value:{error:n,setError:r}},t)}const c=window.wp.apiFetch;var o=n.n(c);const u=window.wp.url;function p(){const[t,n]=(0,e.useState)();return{error:t,setAsyncError:(0,e.useCallback)((e=>{n((()=>{throw e}))}),[])}}const m=(0,e.createContext)();function d({children:t,optionsRestPath:n,populateDefaultValues:r,hasErrorBoundary:s=!1,delaySave:a=!1}){const[i,c]=(0,e.useState)({}),[d,h]=(0,e.useState)(!1),[f,_]=(0,e.useState)(null),[S,E]=(0,e.useState)({}),[g,y]=(0,e.useState)(!1),[b,A]=(0,e.useState)(!1),[v,I]=(0,e.useState)({}),[C,U]=(0,e.useState)({}),{error:P,setError:T}=(0,e.useContext)(l),{setAsyncError:w}=p(),[N,O]=(0,e.useState)(!1),L=(0,e.useRef)(!1);(0,e.useEffect)((()=>()=>{L.current=!0}),[]);const R=(0,e.useCallback)((()=>{P||d||(async()=>{h(!0);try{const e=await o()({path:(0,u.addQueryArgs)(n,{_fields:["suppressed_plugins","suppressible_plugins"]})});if(!0===L.current)return;I({...v,...e})}catch(e){if(!0===L.current)return;return T(e),void(s&&w(e))}h(!1)})()}),[P,d,s,n,v,w,T]);(0,e.useEffect)((()=>{P||Object.keys(v).length||f||(async()=>{_(!0);try{const e=await o()({path:n});if(!0===L.current)return;r||!1!==e.plugin_configured||(e.mobile_redirect=!0,e.reader_theme=null,e.theme_support=null),I(e)}catch(e){if(!0===L.current)return;return T(e),void(s&&w(e))}_(!1)})()}),[P,f,s,v,n,r,w,T]);const x=(0,e.useCallback)((async()=>{y(!0);try{const e={...i};null===e.reader_theme&&delete e.reader_theme,v.plugin_configured||"mobile_redirect"in e||(e.mobile_redirect=v.mobile_redirect),v.plugin_configured||(e.plugin_configured=!0);const[t]=await Promise.all([o()({method:"post",path:n,data:e}),a?new Promise((e=>{setTimeout(e,1e3)})):()=>{}]);if(!0===L.current)return;I(t),T(null)}catch(e){if(!0===L.current)return;return y(!1),T(e),void(s&&w(e))}U({...C,...i}),(0,e.flushSync)((()=>{E(i),c({}),A(!0)})),y(!1)}),[a,s,n,w,v,T,i,C]),M=(0,e.useCallback)((e=>{c({...i,...e}),A(!1)}),[i]),k=(0,e.useCallback)((e=>{const t={...i};delete t[e],c(t)}),[i]);return(0,e.createElement)(m.Provider,{value:{editedOptions:{...v,...i},fetchingOptions:f,hasOptionsChanges:Boolean(Object.keys(i).length),didSaveOptions:b,updates:i,originalOptions:v,saveOptions:x,savedOptions:S,savingOptions:g,unsetOption:k,updateOptions:M,readerModeWasOverridden:N,refetchPluginSuppression:R,setReaderModeWasOverridden:O,modifiedOptions:C}},t)}const h=(0,e.createContext)();function f({children:t}){const[n,r]=(0,e.useState)([]),[s,a]=(0,e.useState)(null),[l,i]=(0,e.useState)(),c=(0,e.useRef)(!1);return(0,e.useEffect)((()=>()=>{c.current=!0}),[]),(0,e.useEffect)((()=>{l||n.length>0||s||(async()=>{a(!0);try{const e=await o()({path:(0,u.addQueryArgs)("/wp/v2/plugins",{_fields:["author","name","plugin","status","version"]})});if(!0===c.current)return;r(e)}catch(e){if(!0===c.current)return;i(e)}a(!1)})()}),[l,s,n]),(0,e.createElement)(h.Provider,{value:{fetchingPlugins:s,plugins:n}},t)}const _="standard";function S(e=""){return e.replace(/\/.*$/,"").replace(/\.php$/,"")}const E=(0,e.createContext)(),g="ACTION_SET_STATUS",y="ACTION_SCANNABLE_URLS_REQUEST",b="ACTION_SCANNABLE_URLS_RECEIVE",A="ACTION_SCAN_INITIALIZE",v="ACTION_SCAN_URL",I="ACTION_SCAN_RECEIVE_RESULTS",C="ACTION_SCAN_COMPLETE",U="ACTION_SCAN_CANCEL",P="STATUS_REQUEST_SCANNABLE_URLS",T="STATUS_FETCHING_SCANNABLE_URLS",w="STATUS_REFETCHING_PLUGIN_SUPPRESSION",N="STATUS_READY",O="STATUS_IDLE",L="STATUS_IN_PROGRESS",R="STATUS_COMPLETED",x="STATUS_FAILED",M="STATUS_CANCELLED",k="STATUS_SKIPPED",B={currentlyScannedUrlIndexes:[],forceStandardMode:!1,scannableUrls:[],scanOnce:!1,status:"",scansCount:0,urlIndexesPendingScan:[]},D=3,W=500;function j(e,t){if(e.status===k)return e;switch(t.type){case g:return{...e,status:t.status};case y:var n;return{...e,status:P,forceStandardMode:null!==(n=t?.forceStandardMode)&&void 0!==n&&n,currentlyScannedUrlIndexes:[],urlIndexesPendingScan:[]};case b:{const n=Array.isArray(t.scannableUrls)&&t.scannableUrls.length>0;return{...e,status:e.scanOnce&&e.scansCount>0||!n?R:N,scannableUrls:n?t.scannableUrls:[]}}case A:return[N,R,x,M].includes(e.status)?e.scanOnce&&e.scansCount>0?{...e,status:R}:{...e,status:O,currentlyScannedUrlIndexes:[],scansCount:e.scansCount+1,urlIndexesPendingScan:e.scannableUrls.map(((e,t)=>t))}:e;case v:return[O,L].includes(e.status)?{...e,status:L,currentlyScannedUrlIndexes:[...e.currentlyScannedUrlIndexes,t.currentlyScannedUrlIndex],urlIndexesPendingScan:e.urlIndexesPendingScan.filter((e=>e!==t.currentlyScannedUrlIndex))}:e;case I:var r;return[O,L].includes(e.status)?{...e,status:O,currentlyScannedUrlIndexes:e.currentlyScannedUrlIndexes.filter((e=>e!==t.currentlyScannedUrlIndex)),scannableUrls:[...e.scannableUrls.slice(0,t.currentlyScannedUrlIndex),{...e.scannableUrls[t.currentlyScannedUrlIndex],stale:!1,error:null!==(r=t.error)&&void 0!==r&&r,validated_url_post:t.error?{}:t.validatedUrlPost,validation_errors:t.error?[]:t.validationErrors},...e.scannableUrls.slice(t.currentlyScannedUrlIndex+1)]}:e;case C:{const t=e.scannableUrls.every((e=>Boolean(e.error)));return{...e,status:t?x:w}}case U:return[O,L].includes(e.status)?{...e,status:M,currentlyScannedUrlIndexes:[],urlIndexesPendingScan:[]}:e;default:throw new Error(`Unhandled action type: ${t.type}`)}}function $({children:t,fetchCachedValidationErrors:n=!1,refetchPluginSuppressionOnScanComplete:r=!1,resetOnOptionsChange:s=!1,scannableUrlsRestPath:a,scanOnce:l=!1,validateNonce:i}){var c;const{originalOptions:{theme_support:d},savedOptions:h,refetchPluginSuppression:f}=(0,e.useContext)(m),{setAsyncError:$}=p(),[F,V]=(0,e.useReducer)(j,{...B,scanOnce:l}),{currentlyScannedUrlIndexes:G,forceStandardMode:H,scannableUrls:Q,urlIndexesPendingScan:z,status:K}=F,J=H||d===_?"url":"amp_url",Y=null!==(c=Q?.[0]?.[J])&&void 0!==c?c:"",{hasSiteScanResults:Z,pluginsWithAmpIncompatibility:q,stale:X,themesWithAmpIncompatibility:ee}=(0,e.useMemo)((()=>{if(![N,R,k].includes(K))return{hasSiteScanResults:!1,pluginsWithAmpIncompatibility:[],stale:!1,themesWithAmpIncompatibility:[]};const e=function(e=[],{useAmpUrls:t=!1}={}){const n=new Map,r=new Map;for(const s of e){const{amp_url:e,url:a,validation_errors:l}=s;if(l?.length)for(const s of l)if(s?.sources?.length)for(const l of s.sources)if(l?.type)if("plugin"===l.type){const r=S(l.name);if("gutenberg"===r&&s.sources.length>1)continue;n.set(r,new Set([...n.get(r)||[],t?e:a]))}else"theme"===l.type&&r.set(l.name,new Set([...r.get(l.name)||[],t?e:a]))}return n.delete("amp"),{plugins:[...n].map((([e,t])=>({slug:e,urls:[...t]}))),themes:[...r].map((([e,t])=>({slug:e,urls:[...t]})))}}(Q,{useAmpUrls:"amp_url"===J});return{hasSiteScanResults:Q.some((e=>Boolean(e?.validation_errors))),pluginsWithAmpIncompatibility:e.plugins,stale:Q.some((e=>!0===e?.stale)),themesWithAmpIncompatibility:e.themes}}),[Q,K,J]);(0,e.useEffect)((()=>{i||K===k||V({type:g,status:k})}),[K,i]);const te=(0,e.useRef)(!1);(0,e.useEffect)((()=>()=>{te.current=!0}),[]);const ne=(0,e.useCallback)(((e={})=>{V({type:y,forceStandardMode:e?.forceStandardMode})}),[]),re=(0,e.useCallback)((()=>{V({type:A})}),[]),se=(0,e.useCallback)((()=>{V({type:U})}),[]);(0,e.useEffect)((()=>{s&&Object.keys(h).length>0&&V({type:y})}),[s,h]),(0,e.useEffect)((()=>{K===N&&Object.keys(h.suppressed_plugins||{}).length>0&&V({type:A})}),[h?.suppressed_plugins,K]),(0,e.useEffect)((()=>{K===w&&(r&&f(),V({type:g,status:R}))}),[f,r,K]);const[ae,le]=(0,e.useState)(!1);return(0,e.useEffect)((()=>{let e;return ae&&(async()=>{await new Promise((t=>{e=setTimeout(t,W)})),!0!==te.current&&le(!1)})(),()=>{e&&clearTimeout(e)}}),[ae]),(0,e.useEffect)((()=>{(async()=>{if(K===P){V({type:g,status:T});try{const e=["url","amp_url","type","label"],t=await o()({path:(0,u.addQueryArgs)(a,{_fields:n?[...e,"validation_errors","stale"]:e,force_standard_mode:H?1:void 0})});if(!0===te.current)return;V({type:b,scannableUrls:t})}catch(e){if(!0===te.current)return;$(e)}}})()}),[n,H,a,$,K]),(0,e.useEffect)((()=>{if(![O,L].includes(K))return;if(0===z.length)return void(0===G.length&&V({type:C}));if(ae||G.length>=D)return;le(!0);const e=z[0];V({type:v,currentlyScannedUrlIndex:e}),(async()=>{const t={};try{const n=Q[e][J],r={amp_validate:{cache:!0,cache_bust:Math.random(),force_standard_mode:H||void 0,nonce:i,omit_stylesheets:!0}},s=await fetch((0,u.addQueryArgs)(n,r)),a=await s.json();if(!0===te.current)return;s.ok?(t.validatedUrlPost=a.validated_url_post,t.validationErrors=a.results.map((({error:e})=>e))):t.error=a?.code||!0}catch(e){if(!0===te.current)return;t.error=!0}V({type:I,currentlyScannedUrlIndex:e,...t}),le(!1)})()}),[G.length,H,Q,ae,K,z,J,i]),(0,e.createElement)(E.Provider,{value:{cancelSiteScan:se,fetchScannableUrls:ne,forceStandardMode:H,hasSiteScanResults:Z,isBusy:[O,L].includes(K),isCancelled:K===M,isCompleted:[w,R].includes(K),isFailed:K===x,isFetchingScannableUrls:[P,T].includes(K),isInitializing:!Boolean(K),isReady:K===N,isSiteScannable:Q.length>0,isSkipped:K===k,pluginsWithAmpIncompatibility:q,previewPermalink:Y,scannableUrls:Q,scannedUrlsMaxIndex:([L,O].includes(K)?Math.min(Q.length,...z):0)-1,stale:X,startSiteScan:re,themesWithAmpIncompatibility:ee}},t)}const F=(0,e.createContext)();function V({children:t}){const[n,r]=(0,e.useState)([]),[s,a]=(0,e.useState)(null),[l,i]=(0,e.useState)(),c=(0,e.useRef)(!1);return(0,e.useEffect)((()=>()=>{c.current=!0}),[]),(0,e.useEffect)((()=>{l||n.length>0||s||(async()=>{a(!0);try{const e=await o()({path:(0,u.addQueryArgs)("/wp/v2/themes",{_fields:["author","name","status","stylesheet","template","version"]})});if(!0===c.current)return;r(e)}catch(e){if(!0===c.current)return;i(e)}a(!1)})()}),[l,s,n]),(0,e.createElement)(F.Provider,{value:{fetchingThemes:s,themes:n}},t)}const G=window.wp.components,H=window.wp.compose,Q=4e3;function z({children:t,onCopy:n,onFinishCopy:r,text:s,...a}){const l=(0,e.useRef)(),i=(0,H.useCopyToClipboard)(s,(()=>{n&&n(),clearTimeout(l.current),r&&(l.current=setTimeout((()=>r()),Q))}));return(0,e.useEffect)((()=>{clearTimeout(l.current)}),[]),(0,e.createElement)(G.Button,{...a,className:"components-clipboard-button",ref:i,onCopy:e=>{e.target.focus()}},t)}function K({error:t,finishLinkLabel:n,finishLinkUrl:r,title:s}){const[l,i]=(0,e.useState)(!1),{message:c,stack:o}=t;return(0,e.createElement)("div",{className:"error-screen-container"},(0,e.createElement)(G.Panel,{className:"error-screen"},(0,e.createElement)("h1",null,s||(0,a.__)("Something went wrong.","amp")),(0,e.createElement)("p",{dangerouslySetInnerHTML:{__html:c||(0,a.__)("There was an error loading the page.","amp")}}),(0,e.createElement)("p",null,(0,e.createInterpolateElement)((0,a.__)("Please submit details to our <a>support forum</a>.","amp"),{a:(0,e.createElement)("a",{href:"https://wordpress.org/support/plugin/amp/",target:"_blank",rel:"noreferrer noopener"})})),o&&(0,e.createElement)("details",null,(0,e.createElement)("summary",null,(0,a.__)("Details","amp")),(0,e.createElement)("pre",null,o),(0,e.createElement)(z,{isSmall:!0,isSecondary:!0,text:JSON.stringify({message:c,stack:o},null,2),onCopy:()=>i(!0),onFinishCopy:()=>i(!1)},l?(0,a.__)("Copied!","amp"):(0,a.__)("Copy Error","amp"))),r&&n&&(0,e.createElement)("p",null,(0,e.createElement)("a",{href:r},n))))}class J extends e.Component{constructor(e){super(e),this.timeout=null,this.state={error:null}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}componentDidCatch(e){this.setState({error:e})}render(){const{error:t}=this.state,{children:n,exitLinkLabel:r,exitLinkUrl:s,title:a}=this.props;return t?(0,e.createElement)(K,{error:t,finishLinkLabel:r,finishLinkUrl:s,title:a}):n}}var Y=n(184),Z=n.n(Y);const q="info",X="success",ee="warning",te="error";function ne({children:t,className:n,isDismissible:r=!1,onDismiss:s,type:l=q}){const[i,c]=(0,e.useState)(!1),o=(0,e.useCallback)((()=>{c(!0),"function"==typeof s&&s()}),[s]);return r&&i?null:(0,e.createElement)("div",{className:Z()("amp-admin-notice",n,{"amp-admin-notice--dismissible":r,"amp-admin-notice--info":l===q,"amp-admin-notice--success":l===X,"amp-admin-notice--warning":l===ee,"amp-admin-notice--error":l===te})},t,r&&(0,e.createElement)("button",{type:"button",onClick:o,className:"amp-admin-notice__dismiss"},(0,e.createElement)(G.VisuallyHidden,{as:"span"},(0,a.__)("Dismiss","amp"))))}function re({inline:t=!1}){const n=t?"span":"div";return(0,e.createElement)(n,{className:Z()("amp-spinner-container",{"amp-spinner-container--inline":t})},(0,e.createElement)(G.Spinner,null))}const se=e=>n.g?.location?.host!==new URL(e).host,ae=new URL(t.SETTINGS_LINK);function le({pluginsWithAmpIncompatibility:n}){const{fetchingPlugins:r,plugins:s}=(0,e.useContext)(h),l=(0,e.useMemo)((()=>s?.reduce(((e,t)=>({...e,[S(t.plugin)]:t.name})),{})),[s]);return r?null:(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,a._n)("AMP compatibility issue(s) discovered with the following plugin:","AMP compatibility issue(s) discovered with the following plugins:",n.length,"amp")),n.map((t=>(0,e.createElement)("details",{key:t.slug,className:"amp-site-scan-notice__source-details"},(0,e.createElement)("summary",{className:"amp-site-scan-notice__source-summary"},(0,e.createInterpolateElement)((0,a.sprintf)(/* translators: 1: plugin name; 2: number of URLs with AMP validation issues. */
(0,a._n)("<b>%1$s</b> on %2$d URL","<b>%1$s</b> on %2$d URLs",t.urls.length,"amp"),l[t.slug],t.urls.length),{b:(0,e.createElement)("b",null)})),(0,e.createElement)("ul",{className:"amp-site-scan-notice__urls-list"},t.urls.map((t=>(0,e.createElement)("li",{key:t},(0,e.createElement)("a",{href:t,target:"_blank",rel:"noopener noreferrer"},t)))))))),(0,e.createElement)("div",{className:"amp-site-scan-notice__cta"},(0,e.createElement)("a",{href:ae.href,className:"button"},(0,a.__)("Review Plugin Suppression","amp")),(0,e.createElement)("a",{href:t.AMP_COMPATIBLE_PLUGINS_URL,className:"button",...se(t.AMP_COMPATIBLE_PLUGINS_URL)?{target:"_blank",rel:"noopener noreferrer"}:{}},(0,a.__)("View AMP-Compatible Plugins","amp"))))}function ie({themesWithAmpIncompatibility:n}){const{fetchingThemes:r,themes:s}=(0,e.useContext)(F),l=(0,e.useMemo)((()=>s?.reduce(((e,t)=>{var n;return{...e,[t.stylesheet]:null!==(n=t.name?.rendered)&&void 0!==n?n:t.name}}),{})),[s]);return r?null:(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,a._n)("AMP compatibility issue(s) discovered with the following theme:","AMP compatibility issue(s) discovered with the following themes:",n.length,"amp")),n.map((t=>(0,e.createElement)("details",{key:t.slug,className:"amp-site-scan-notice__source-details"},(0,e.createElement)("summary",{className:"amp-site-scan-notice__source-summary"},(0,e.createInterpolateElement)((0,a.sprintf)(/* translators: 1: theme name; 2: number of URLs with AMP validation issues. */
(0,a._n)("<b>%1$s</b> on %2$d URL","<b>%1$s</b> on %2$d URLs",t.urls.length,"amp"),l[t.slug],t.urls.length),{b:(0,e.createElement)("b",null)})),(0,e.createElement)("ul",{className:"amp-site-scan-notice__urls-list"},t.urls.map((t=>(0,e.createElement)("li",{key:t},(0,e.createElement)("a",{href:t,target:"_blank",rel:"noopener noreferrer"},t)))))))),(0,e.createElement)("div",{className:"amp-site-scan-notice__cta"},(0,e.createElement)("a",{href:t.AMP_COMPATIBLE_THEMES_URL,className:"button",...se(t.AMP_COMPATIBLE_THEMES_URL)?{target:"_blank",rel:"noopener noreferrer"}:{}},(0,a.__)("View AMP-Compatible Themes","amp"))))}function ce(){const{cancelSiteScan:t,fetchScannableUrls:n,isCancelled:r,isCompleted:s,isFailed:l,isInitializing:i,isReady:c,pluginsWithAmpIncompatibility:o,themesWithAmpIncompatibility:u,startSiteScan:p}=(0,e.useContext)(E);(0,e.useEffect)((()=>t),[t]),(0,e.useEffect)((()=>{i?n():c&&p()}),[n,i,c,p]);const m={className:"amp-site-scan-notice",isDismissible:!0,onDismiss:t};if(l||r)return(0,e.createElement)(ne,{type:te,...m},(0,e.createElement)("p",null,(0,a.__)("AMP could not check your site for compatibility issues.","amp")));if(s){let t=[o.length>0?(0,e.createElement)(le,{key:`plugins-${o.length}`,pluginsWithAmpIncompatibility:o}):null,u.length>0?(0,e.createElement)(ie,{key:`themes-${u.length}`,themesWithAmpIncompatibility:u}):null];return document.location.href.includes("themes.php")&&(t=t.reverse()),t=t.filter(Boolean),(0,e.createElement)(ne,{type:t.length?ee:X,...m},t.length?t:(0,e.createElement)("p",null,(0,a.__)("No AMP compatibility issues detected.","amp")))}return(0,e.createElement)(ne,{type:q,...m},(0,e.createElement)("p",null,(0,a.__)("Checking your site for AMP compatibility issues…","amp"),(0,e.createElement)(re,{inline:!0})))}let oe;function ue({children:r}){return n.g.removeEventListener("error",oe),(0,e.createElement)(i,null,(0,e.createElement)(J,{title:(0,a.__)("The AMP Site Scanner has experienced an error.","amp")},(0,e.createElement)(d,{hasErrorBoundary:!0,optionsRestPath:t.OPTIONS_REST_PATH,populateDefaultValues:!1},(0,e.createElement)(f,null,(0,e.createElement)(V,null,(0,e.createElement)($,{scannableUrlsRestPath:t.SCANNABLE_URLS_REST_PATH,validateNonce:t.VALIDATE_NONCE},r))))))}ae.hash="plugin-suppression",s()((()=>{let r=document.getElementById(t.APP_ROOT_ID);if(!r){const e=document.getElementById(t.APP_ROOT_SIBLING_ID);if(!e)return;r=document.createElement("div"),r.setAttribute("id",t.APP_ROOT_ID),e.after(r)}oe=t=>{t.filename&&/amp-site-scan-notice(\.min)?\.js/.test(t.filename)&&(0,e.createRoot)(r).render((0,e.createElement)(K,{error:t.error}))},n.g.addEventListener("error",oe),(0,e.createRoot)(r).render((0,e.createElement)(ue,null,(0,e.createElement)(ce,null)))}))})()})();